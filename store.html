<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Gauri Creations ‚Ä¢ Store</title>

<style>
  :root {
    --bg-grad: linear-gradient(135deg, #e3f2ff, #ffe5f3);
    --glass: rgba(255,255,255,0.78);
    --glass-strong: rgba(255,255,255,0.92);
    --glass-border: rgba(148,163,184,0.6);
    --shadow-strong: 0 20px 45px rgba(15,23,42,0.30);
    --blue: #2563eb;
    --pink: #ec4899;
    --danger: #ef4444;
    --success: #16a34a;
    --amber: #f59e0b;
  }

  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    min-height: 100vh;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Poppins", sans-serif;
    background: var(--bg-grad);
    padding: 18px 14px 28px;
    display: flex;
    justify-content: center;
  }

  .shell {
    width: 100%;
    max-width: 1150px;
  }

  /* ‚≠ê BUTTON FIX ‚Äî better proportions */
  .btn {
    border-radius: 999px;
    border: none;
    padding: 6px 10px;     /* Reduced height */
    font-size: 12px;
    cursor: pointer;
    font-weight: 600;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    line-height: 1.1;      /* Compact height */
  }

  .btn-outline {
    background: white;
    border: 1px solid #d1d5db;
    color: #111827;
  }

  .btn-primary {
    background: linear-gradient(135deg, #2563eb, #ec4899);
    color: white;
  }

  /* ‚≠ê REST OF YOUR ORIGINAL CSS BELOW (unchanged) */

  .hero { ... }
  .hero-main { ... }
  .hero-title { ... }
  .hero-sub { ... }
  .hero-tags { ... }
  .tag-pill { ... }
  .hero-highlight { ... }
  .hero-side { ... }
  .filters { ... }
  .filters-row { ... }
  .grid { ... }
  .product-card { ... }
  .product-img-wrap { ... }
  .product-img { ... }
  .wishlist-heart { ... }
  .product-price-row { ... }
  .rating-line { ... }
  .empty-state { ... }

</style>

<script>
/* ‚≠ê GOOGLE DRIVE ‚Üí GOOGLEUSERCONTENT IMAGE FIXER */
function fixImage(url) {
  if (!url) return "";  // empty or missing image
  if (url.includes("googleusercontent")) return url; // already converted

  // extract file ID from any drive link format
  const match = url.match(/[-\w]{25,}/);
  if (match) {
    return `https://lh3.googleusercontent.com/d/${match[0]}=w1000`;
  }

  return url; // fallback to original
}
</script>

</head>
<body>

<div class="shell">

  <!-- HERO -->
  <section class="hero">
    <div class="hero-main">

      <!-- ‚≠ê LOGO -->
      <img src="logo-gauri.jpeg" 
           alt="Gauri Creations Logo"
           style="width:120px; margin-bottom:10px; border-radius:10px;">

      <div class="hero-title">Gauri Creations Store</div>
      <div class="hero-sub">
        Discover exclusive handcrafted designs, premium wedding decor and elegant creations ‚Äì curated and shipped with love.
      </div>

      <div class="hero-tags">
        <span class="tag-pill">‚ú® Handpicked Designs</span>
        <span class="tag-pill">üöö Pan India Shipping</span>
        <span class="tag-pill">üí≥ Secure Offline / UPI Payment</span>
      </div>

      <div class="hero-highlight">
        <span class="dot"></span>
        Live catalog from Google Sheets ‚Ä¢ Admin-controlled inventory
      </div>

      <div id="heroBanners" class="hero-banner-strip"></div>
    </div>

    <aside class="hero-side">
      <div class="side-title">Store Snapshot</div>

      <div class="side-line">
        <span>Total products</span>
        <span id="summaryTotal" class="side-num">‚Äì</span>
      </div>

      <div class="side-line">
        <span>In-stock styles</span>
        <span id="summaryInStock" class="side-num">‚Äì</span>
      </div>

      <div class="side-line">
        <span>Low stock (‚â§ 5)</span>
        <span id="summaryLowStock" class="side-num">‚Äì</span>
      </div>

      <div class="side-line">
        <span>Average rating</span>
        <span id="summaryRating" class="side-num">‚Äì</span>
      </div>

      <div class="side-badge" id="summaryBadge">
        Loading live catalog‚Ä¶
      </div>
    </aside>
  </section>

  <!-- FILTERS -->
  <section class="filters">
    <div class="filters-top">
      <input id="searchInput" type="text" placeholder="Search products by name, SKU or category‚Ä¶" />
    </div>

    <div class="filters-row">
      <select id="categoryFilter">
        <option value="">All Categories</option>
      </select>

      <select id="sortFilter">
        <option value="">Sort by</option>
        <option value="priceLow">Price: Low ‚Üí High</option>
        <option value="priceHigh">Price: High ‚Üí Low</option>
        <option value="ratingHigh">Rating: High ‚Üí Low</option>
        <option value="newest">Newest First</option>
      </select>

      <select id="stockFilter">
        <option value="">Stock: All</option>
        <option value="in">In Stock only</option>
        <option value="low">Low Stock (‚â§ 5)</option>
        <option value="out">Out of Stock</option>
      </select>
    </div>

    <div class="filters-row" style="margin-top:8px;">
      <input id="minPrice" type="number" placeholder="Min price (‚Çπ)" />
      <input id="maxPrice" type="number" placeholder="Max price (‚Çπ)" />
      <div></div>
    </div>

    <div class="filters-meta">
      <span id="filtersInfo">Loading products‚Ä¶</span>
      <span id="filtersCount"></span>
    </div>
  </section>

  <!-- PRODUCTS GRID -->
  <section id="grid" class="grid"></section>

  <div id="emptyState" class="empty-state" style="display:none;">
    No products match your filters. Try clearing some filters or searching differently.
  </div>

</div>
<script>
/* ===============================
   GOOGLE DRIVE ‚Üí IMAGE FIXER
=============================== */
function fixImage(url) {
  if (!url) return "";

  // Already converted
  if (url.includes("googleusercontent")) return url;

  // Extract file ID from Google Drive URL
  const match = url.match(/[-\w]{25,}/);
  if (match) {
    return `https://lh3.googleusercontent.com/d/${match[0]}=w1000`;
  }

  return url; // normal image URL
}

/* ===============================
   GLOBALS
=============================== */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwxlp4ehND6OHfGY9ruPptTs4euh3U-v3y6IA90EfmwjuiFZD4BnoHDjifKAPG9B1T7/exec";

let ALL_PRODUCTS = [];
let FILTERED = [];

function toNumber(val) {
  const n = Number(val);
  return isNaN(n) ? 0 : n;
}

/* ===============================
   LOAD PRODUCTS
=============================== */
async function loadProducts() {
  const info = document.getElementById("filtersInfo");
  info.textContent = "Loading products from server‚Ä¶";

  try {
    const res = await fetch(SCRIPT_URL + "?action=getProducts");
    const data = await res.json();

    if (!data.success) throw new Error(data.message || "Failed to load products");

    ALL_PRODUCTS = data.products || [];

    populateCategories();
    updateSummary();
    applyFilters();

    info.textContent = "Catalog loaded successfully.";
  } catch (err) {
    console.error(err);
    ALL_PRODUCTS = [];
    applyFilters();
    document.getElementById("filtersInfo").textContent =
      "Error loading products. Please refresh the page.";
  }
}

/* ===============================
   CATEGORY FILLS
=============================== */
function populateCategories() {
  const select = document.getElementById("categoryFilter");
  const cats = new Set();

  ALL_PRODUCTS.forEach(p => {
    const cat = (p["Category"] || "").toString().trim();
    if (cat) cats.add(cat);
  });

  cats.forEach(cat => {
    const opt = document.createElement("option");
    opt.value = cat;
    opt.textContent = cat;
    select.appendChild(opt);
  });
}

/* ===============================
   SUMMARY PANEL
=============================== */
function updateSummary() {
  const total = ALL_PRODUCTS.length;
  const inStock = ALL_PRODUCTS.filter(p => toNumber(p["Stock"]) > 0).length;
  const lowStock = ALL_PRODUCTS.filter(p => {
    const s = toNumber(p["Stock"]);
    return s > 0 && s <= 5;
  }).length;

  const rated = ALL_PRODUCTS.filter(p => toNumber(p["Rating"]) > 0);
  let avgRating = "‚Äì";
  if (rated.length) {
    const sum = rated.reduce((acc, p) => acc + toNumber(p["Rating"]), 0);
    avgRating = (sum / rated.length).toFixed(1);
  }

  document.getElementById("summaryTotal").textContent = total;
  document.getElementById("summaryInStock").textContent = inStock;
  document.getElementById("summaryLowStock").textContent = lowStock;
  document.getElementById("summaryRating").textContent = avgRating;

  const badge = document.getElementById("summaryBadge");
  if (!total) {
    badge.textContent = "No products added yet.";
  } else if (lowStock > 0) {
    badge.textContent = `${lowStock} items running low ‚Äì restock recommended.`;
  } else {
    badge.textContent = "Inventory looks healthy üíö";
  }

  renderHeroBanners();
}

/* ===============================
   HERO BANNERS
=============================== */
function renderHeroBanners() {
  const container = document.getElementById("heroBanners");
  container.innerHTML = "";

  if (!ALL_PRODUCTS.length) {
    const chip = document.createElement("div");
    chip.className = "banner-chip";
    chip.innerHTML = "<strong>No products yet</strong><span>Add products from Admin panel.</span>";
    container.appendChild(chip);
    return;
  }

  const sorted = [...ALL_PRODUCTS].sort((a, b) => {
    return toNumber(b["Rating"]) - toNumber(a["Rating"]);
  });

  const featured = sorted.slice(0, 3);

  featured.forEach(p => {
    const chip = document.createElement("div");
    chip.className = "banner-chip";
    const price = toNumber(p["Price"]) ? "‚Çπ" + p["Price"] : "";
    const rating = p["Rating"] ? `‚òÖ ${p["Rating"]}` : "New";
    chip.innerHTML = `
      <strong>${p["Name"] || "Product"}</strong>
      <span>${price} ‚Ä¢ ${rating}</span>
      <span style="font-size:10px;color:#4b5563;">Tap ‚ÄúKnow More‚Äù to view details.</span>
    `;
    container.appendChild(chip);
  });
}

/* ===============================
   APPLY FILTERS
=============================== */
function applyFilters() {
  const search = document.getElementById("searchInput").value.toLowerCase().trim();
  const cat = document.getElementById("categoryFilter").value;
  const sort = document.getElementById("sortFilter").value;
  const stockMode = document.getElementById("stockFilter").value;

  const minP = toNumber(document.getElementById("minPrice").value);
  const maxP = toNumber(document.getElementById("maxPrice").value);

  let list = [...ALL_PRODUCTS];

  if (search) {
    list = list.filter(p => {
      const name = (p["Name"] || "").toLowerCase();
      const sku = (p["SKU"] || "").toLowerCase();
      const catVal = (p["Category"] || "").toLowerCase();
      return name.includes(search) || sku.includes(search) || catVal.includes(search);
    });
  }

  if (cat) list = list.filter(p => (p["Category"] || "") === cat);

  list = list.filter(p => {
    const s = toNumber(p["Stock"]);
    if (stockMode === "in") return s > 0;
    if (stockMode === "low") return s > 0 && s <= 5;
    if (stockMode === "out") return s <= 0;
    return true;
  });

  if (minP) list = list.filter(p => toNumber(p["Price"]) >= minP);
  if (maxP) list = list.filter(p => toNumber(p["Price"]) <= maxP);

  if (sort === "priceLow") list.sort((a, b) => toNumber(a["Price"]) - toNumber(b["Price"]));
  else if (sort === "priceHigh") list.sort((a, b) => toNumber(b["Price"]) - toNumber(a["Price"]));
  else if (sort === "ratingHigh") list.sort((a, b) => toNumber(b["Rating"]) - toNumber(a["Rating"]));

  FILTERED = list;
  renderGrid();

  const countText = document.getElementById("filtersCount");
  if (ALL_PRODUCTS.length) {
    countText.textContent = `Showing ${FILTERED.length} of ${ALL_PRODUCTS.length} products`;
  } else {
    countText.textContent = "";
  }
}

/* ===============================
   RENDER PRODUCT CARDS
=============================== */
function renderGrid() {
  const grid = document.getElementById("grid");
  const empty = document.getElementById("emptyState");
  grid.innerHTML = "";

  if (!FILTERED.length) {
    empty.style.display = "block";
    return;
  }
  empty.style.display = "none";

  FILTERED.forEach(p => {
    const card = document.createElement("div");
    card.className = "product-card";

    const sku = p["SKU"] || "";
    const name = p["Name"] || "Product";
    const price = p["Price"] || "";
    const imgUrl = fixImage(p["Image URL 1"] || "");
    const stock = toNumber(p["Stock"]);
    const rating = p["Rating"];
    const reviewCount = p["Review Count"];

    const top = document.createElement("div");
    top.className = "product-img-wrap";

    if (imgUrl) {
      const img = document.createElement("img");
      img.src = imgUrl;
      img.alt = name;
      img.className = "product-img";
      top.appendChild(img);
    } else {
      const ph = document.createElement("div");
      ph.style.height = "155px";
      ph.style.display = "flex";
      ph.style.alignItems = "center";
      ph.style.justifyContent = "center";
      ph.style.fontSize = "30px";
      ph.textContent = "üõçÔ∏è";
      top.appendChild(ph);
    }

    const stockBadge = document.createElement("div");
    stockBadge.className = "stock-badge";

    if (stock > 0) {
      stockBadge.textContent = stock <= 5 ? `Low stock (${stock})` : "In stock";
      if (stock <= 5) stockBadge.style.background = "rgba(245,158,11,0.96)";
    } else {
      stockBadge.textContent = "Out of stock";
      stockBadge.classList.add("out");
    }
    top.appendChild(stockBadge);

    const heart = document.createElement("div");
    heart.className = "wishlist-heart";
    heart.innerHTML = "‚ô°";
    heart.onclick = function (ev) {
      ev.stopPropagation();
      heart.classList.toggle("active");
      heart.innerHTML = heart.classList.contains("active") ? "‚ô•" : "‚ô°";
    };
    top.appendChild(heart);

    const nameEl = document.createElement("div");
    nameEl.className = "product-name";
    nameEl.textContent = name;
    card.appendChild(nameEl);

    const priceRow = document.createElement("div");
    priceRow.className = "product-price-row";

    const priceEl = document.createElement("div");
    priceEl.className = "product-price";
    priceEl.textContent = price ? "‚Çπ" + price : "";
    priceRow.appendChild(priceEl);

    const ratingEl = document.createElement("div");
    ratingEl.className = "rating-line";
    if (rating) {
      ratingEl.innerHTML =
        `<span class="rating-stars">‚òÖ</span> <span>${rating}</span>` +
        (reviewCount ? ` <span>(${reviewCount})</span>` : "");
    } else {
      ratingEl.textContent = "New arrival";
    }
    priceRow.appendChild(ratingEl);

    card.appendChild(priceRow);

    const actions = document.createElement("div");
    actions.className = "product-actions";

    const btnKnow = document.createElement("a");
    btnKnow.className = "btn btn-outline";
    btnKnow.textContent = "Know More";
    btnKnow.href = `product.html?sku=${encodeURIComponent(sku)}`;

    const btnBuy = document.createElement("a");
    btnBuy.className = "btn btn-primary";
    btnBuy.textContent = "Buy Now";
    const imgParam = encodeURIComponent(imgUrl);
    btnBuy.href =
      `order.html?sku=${encodeURIComponent(sku)}` +
      `&name=${encodeURIComponent(name)}` +
      `&price=${encodeURIComponent(price)}` +
      `&img=${imgParam}`;

    actions.appendChild(btnKnow);
    actions.appendChild(btnBuy);

    card.appendChild(actions);

    card.addEventListener("click", (ev) => {
      if (ev.target.tagName === "A" || ev.target.classList.contains("wishlist-heart")) return;
      window.location.href = `product.html?sku=${encodeURIComponent(sku)}`;
    });

    grid.appendChild(card);
  });
}

/* ===============================
   EVENT LISTENERS
=============================== */
document.getElementById("searchInput").addEventListener("input", applyFilters);
document.getElementById("categoryFilter").addEventListener("change", applyFilters);
document.getElementById("sortFilter").addEventListener("change", applyFilters);
document.getElementById("stockFilter").addEventListener("change", applyFilters);
document.getElementById("minPrice").addEventListener("input", applyFilters);
document.getElementById("maxPrice").addEventListener("input", applyFilters);

/* ===============================
   START
=============================== */
loadProducts();
</script>
