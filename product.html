<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Product ‚Ä¢ Gauri Creations</title>

<!-- üîí STYLES UNCHANGED -->
<style>
/* (styles exactly same as you sent ‚Äî not repeated here for brevity) */
</style>
</head>

<body>

<div class="menu-btn" onclick="toggleMenu()">‚ò∞ Menu</div>

<div id="menuBox" class="menu-box">
  <div class="menu-item" onclick="goTrack()">üì¶ Track Order</div>
  <div class="menu-item" onclick="goMyOrders()">üßæ My Orders</div>
  <div class="menu-item" onclick="goSupport()">üí¨ Support</div>
  <div class="menu-item" onclick="goLogin()">üîê Login</div>
</div>

<div class="shell">
  <div class="top-hero">
    <img src="logo-gauri.jpeg" class="logo">
    <div>
      <div class="store-title">Gauri Creations</div>
      <div class="store-sub">Handcrafted decor ‚Ä¢ Secure UPI checkout</div>
    </div>
  </div>

  <div class="product-grid">
    <div class="images-card">
      <div class="wish-btn" id="wishBtn" onclick="toggleWishlist()">ü§ç</div>
      <div class="main-image-wrap">
        <img id="mainImage" class="main-image">
      </div>
      <div id="thumbs" class="thumbs"></div>
    </div>

    <div class="details-card">
      <div>
        <div id="prodName" class="prod-name">Product</div>
        <div id="prodSku" class="prod-sku">SKU: -</div>
      </div>

      <div style="display:flex;justify-content:space-between">
        <div id="prodPrice" class="price">‚Çπ0</div>
        <div id="prodRating" class="rating">‚òÖ -</div>
      </div>

      <div id="prodDesc" class="specs"></div>

      <div class="actions">
        <button id="btnBuyNow" class="btn btn-primary">Buy Now</button>
        <button class="btn btn-outline">Add to My Orders</button>
      </div>
    </div>
  </div>
</div>

<div id="lightboxOverlay" onclick="closeLightbox()">
  <img id="lightboxImg">
</div>

<script>
const SCRIPT_URL =
"https://script.google.com/macros/s/AKfycbyNznWMbvHaiu7PjF-Kz5i35E1cNq5FobRnjJ2pAWcmhCL42R8f7A_WXxQUkQebdDE/exec";

let CURRENT_SKU = null;

/* ‚ù§Ô∏è Wishlist helpers ‚Äî FIXED */
function getWishlist(){
  return JSON.parse(localStorage.getItem("gc_wishlist") || "[]");
}
function saveWishlist(list){
  localStorage.setItem("gc_wishlist", JSON.stringify(list));
}
function toggleWishlist(){
  if(!CURRENT_SKU) return;
  const list = getWishlist();
  const i = list.indexOf(CURRENT_SKU);

  if(i >= 0){
    list.splice(i,1);
    wishBtn.textContent = "ü§ç";
  }else{
    list.push(CURRENT_SKU);
    wishBtn.textContent = "‚ù§Ô∏è";
  }
  saveWishlist(list);
}

function normalizeMediaUrl(url){
  if(!url) return "";
  if(url.includes("googleusercontent")) return url;
  const m=url.match(/[-A-Za-z0-9_]{20,}/);
  return m?`https://lh3.googleusercontent.com/d/${m[0]}=w1000`:url;
}
function qs(id){return document.getElementById(id);}
function getQuery(){
  const q={};
  location.search.slice(1).split("&").forEach(p=>{
    const [k,v]=p.split("=");
    q[decodeURIComponent(k)]=decodeURIComponent(v||"");
  });
  return q;
}

async function loadProduct(){
  const {sku}=getQuery();
  if(!sku) return;
  CURRENT_SKU = sku;

  const res=await fetch(`${SCRIPT_URL}?action=getProduct&sku=`+sku);
  const data=await res.json();
  if(!data.success) return;

  const p=data.product;

  qs("prodName").textContent=p.Name;
  qs("prodSku").textContent="SKU: "+p.SKU;
  qs("prodPrice").textContent="‚Çπ"+p.Price;
  qs("prodRating").textContent=p.Rating?("‚òÖ "+p.Rating):"New";
  qs("prodDesc").textContent=p.Description;

  const imgs=[];
  for(let i=1;i<=5;i++){
    if(p["Image URL "+i]) imgs.push(normalizeMediaUrl(p["Image URL "+i]));
  }

  qs("mainImage").src=imgs[0]||"";
  qs("mainImage").onclick=()=>openLightbox(qs("mainImage").src);

  const t=qs("thumbs");
  t.innerHTML="";
  imgs.forEach(u=>{
    const d=document.createElement("div");
    d.className="thumb";
    d.innerHTML=`<img src="${u}">`;
    d.onclick=()=>qs("mainImage").src=u;
    t.appendChild(d);
  });

  // ‚ù§Ô∏è sync wishlist state
  if(getWishlist().includes(p.SKU)){
    qs("wishBtn").textContent="‚ù§Ô∏è";
  }

  qs("btnBuyNow").onclick=()=>{
    location.href=`order.html?sku=${encodeURIComponent(p.SKU)}`;
  };
}

function openLightbox(src){
  qs("lightboxImg").src=src;
  qs("lightboxOverlay").style.display="flex";
}
function closeLightbox(){
  qs("lightboxOverlay").style.display="none";
}

document.addEventListener("DOMContentLoaded", loadProduct);
</script>
</body>
</html>
